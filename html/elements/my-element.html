<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="my-element" noscript attributes="color owner">
  <template>
    <div style="{{ {color:'red', background: '#efefef'} | styleObject }}">
        <span>I'm <b>my-element</b>. This is my Shadow DOM. And its for {{owner | plusOne}}.</span>
        <core-ajax url="/json.html" auto response="{{resp}}"></core-ajax>
        <textarea value="{{resp}}" style="display:block"></textarea>
        <div id="thePerson" style="color: {{color}}">Waiting...</div>
        <button on-click="{{setFocus}}" hidden?="{{moreThanOne}}">Set focus on owner</button>
        <button on-click="{{cloneThis}}">Clone this</button>
        <button on-click="{{deleteThis}}" id="deleteButton">{{deleteText}}</button>
        <input id="nameInput" value="{{owner | toUpperCase }}"
               placeholder="Enter name...">
    </div>
    <table>
        <tr template repeat="{{tr in rows}}">
            <td>{{tr}}</td>
        </tr>
    </table>
  </template>
  <script>
    Polymer({
        owner: "Someone",
        color: "red",
        typed: true,
        deleteText: "Delete This",
        rows: [1, 2, 3],
        moreThanOne: false,
        ready: function () {

            this.$.thePerson.textContent = this.owner + " thinks this is cool."
        },
        attached: function () {
            this.hideOrShowDelete();
            this.moreThanOne = this.isMoreThanOneMyElement();
        },
        detached: function () {
            this.hideOrShowDelete();
        },
        hideOrShowDelete: function () {
            var display = (this.numMyElements() > 1) ? "inline-block" : "none";
            var elms = document.getElementsByTagName('my-element');
            for (var ii = 0; ii < elms.length; ii++) {
                elms[ii].$.deleteButton.style.display = display;
            }
        },
        ownerChanged:  function () {
            if (this.typed) {
                this.color = "blue";
            } else {
                this.color = "black";
            }
            this.typed = !this.typed;
        },
        setFocus: function () {
            this.$.nameInput.focus();
        },
        cloneThis: function(evt, detail, sender) {
            var el = document.createElement('my-element');
            document.body.appendChild(el);

            var noticeTag = document.createElement('span');
            noticeTag.textContent = " - CLONED";
            sender.insertBefore(noticeTag);
        },
        deleteThis: function (evt, detail, sender) {
            this.remove();
        },
        numMyElements: function () {
            return document.getElementsByTagName('my-element').length;
        },
        isMoreThanOneMyElement: function () {
            return this.numMyElements() < 2;
        },
        toUpperCase: {
            toDOM: function (val) {
                return val.toUpperCase();
            },
            toModel: function (val) {
                return val.toUpperCase();
            }
        },
    });

    PolymerExpressions.prototype.plusOne = function (val) {
        return val + " one ";
    };

  </script>
</polymer-element>