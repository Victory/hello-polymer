<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="my-element" noscript attributes="color owner">
  <template>
    <div style="{{ {color:'red', background: '#efefef'} | styleObject }}">
        <span>I'm <b>my-element</b>. This is my Shadow DOM. And its for {{owner}}.</span>
        <core-ajax url="/json.html" auto response="{{resp}}"></core-ajax>
        <textarea value="{{resp}}" style="display:block"></textarea>
        <div id="thePerson" style="color: {{color}}">Waiting...</div>
        <button on-click="{{setFocus}}">Set focus on owner</button>
        <button on-click="{{cloneThis}}">Clone this</button>
        <button on-click="{{deleteThis}}" id="deleteButton">Delete this</button>
        <input id="nameInput" value="{{owner}}"
               placeholder="Enter name...">
    </div>
  </template>
  <script>
    Polymer({
        owner: "Someone",
        color: "red",
        typed: true,
        ready: function () {
            this.$.thePerson.textContent = this.owner + " thinks this is cool."
        },
        attached: function () {
            this.hideOrShowDelete();
        },
        detached: function () {
            this.hideOrShowDelete();
        },
        hideOrShowDelete: function () {
            var display = (this.numMyElements() > 1) ? "inline-block" : "none";
            var elms = document.getElementsByTagName('my-element');
            for (var ii = 0; ii < elms.length; ii++) {
                console.log(ii);
                elms[ii].$.deleteButton.style.display = display;
            }
        },
        ownerChanged:  function () {
            if (this.typed) {
                this.color = "blue";
            } else {
                this.color = "black";
            }
            this.typed = !this.typed;
        },
        setFocus: function () {
            this.$.nameInput.focus();
        },
        cloneThis: function () {
            var el = document.createElement('my-element');
            document.body.appendChild(el);
        },
        deleteThis: function () {
            this.remove();
        },
        numMyElements: function () {
            return document.getElementsByTagName('my-element').length;
        }
    });
  </script>
</polymer-element>